<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Test AWS Lambda</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <h1>Simple Demo for PUT, GET, and DELETE</h1>

    <table id="item-table">
        <tr>
            <th>Id</th><th>Name</th><th>Action</th>
        </tr>
    </table>

    <p id="lambda-info">
        <!-- loaded with AJAX -->
    </p>

    <button id="load-data">Load Data</button>
    <p>Loads data from the server</p>
    

    <p id ="test"></p>

    <hr>
    <!-- <button id="send-data">Send Data</button>
    <p>Sends an example JSON object to the server with id 11111</p> -->
    <!-- <script>
        document.getElementById("send-data").onclick = function () {
            let xhr = new XMLHttpRequest();
            xhr.open("PUT", "https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSON.stringify({
                "id": "6666666",
                "price": 19,
                "name": "test put value"
            }));
        }
    </script> -->



    <hr>
    <button id="delete-data">Delete Data</button>
    <p>Deletes a JSON object from the server with 11111</p>
    <!-- <script>
        document.getElementById("item-table").onclick = function () {
            let xhr = new XMLHttpRequest();
            xhr.open("DELETE", "https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items/6666666");
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send();
        }
    </script> -->







    <hr>
    <div>
    <div class="inputdiv">
        <h3>Add New Item to Database</h3>
        <br>
        <form id="formelement" action="">
            <label class="IDc" for="ID">ID:</label>
            <input required type="text" name="ID" id="ID">
            <br>
            <label class="Namec" for="Name">Name:</label>
            <input required type="text" name="Name" id="Name">
            <br>
            <label class="Pricec" for="Price">Price: </label>
            <input required type="text" name="Price" id="Price">
            <br>
            <button id="send-data" type="button">Add Item</button>
        </form>

    </div>
    </div>

<script>

    // function deletedata(eleid){
    //     document.getElementById("item-table").onclick = function () {
            
    //         let xhr = new XMLHttpRequest();
    //         xhr.open("DELETE", "https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items/" + eleid);
    //         xhr.setRequestHeader("Content-Type", "application/json");
    //         xhr.send();
    //     }
    // }



    let price;
    document.getElementById("load-data").onclick = function () {
        let lambda = document.getElementById("lambda-info");
        let responsedata;
        let xhr = new XMLHttpRequest();
        xhr.addEventListener("load", function () {
            lambda.innerHTML = xhr.response;
            responsedata = xhr.response;
            
        });

        let testele = document.getElementById("test");
        xhr.addEventListener("load", function () {
            
            let btnid = 0;
            let data = JSON.parse(xhr.responseText);
           

            let table = document.getElementById("item-table");
             table.querySelectorAll("tr:not(:first-child)").forEach(row => row.remove());
                data.forEach(item => {
                    
                    let row = table.insertRow();  // create a new row
                    row.insertCell(0).textContent = item.id;   // ID column
                    row.insertCell(1).textContent = item.name; // Name column

                    // Action column (example: a button)
                    let actionCell = row.insertCell(2);
                    let btn = document.createElement("button");
                    btn.textContent = "Delete";
                    btn.onclick = function () {
                        let deleteXhr = new XMLHttpRequest();
                        deleteXhr.open("DELETE", `https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items/${item.id}`);
                        deleteXhr.setRequestHeader("Content-Type", "application/json");
                        deleteXhr.send();
                        deleteXhr.onload = function(){
                            if(deleteXhr.status == 200){
                                console.log(`Item ${item.id} deleted`);
                                row.remove();
                            }else{
                                console.log(`ITEM DELETION FAILED`);
                            }
                        }
                    };
                    actionCell.appendChild(btn);
                });
            
        });



        xhr.open("GET", "https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items");
        xhr.send();



        }

        document.getElementById("send-data").onclick = function () {
            const form1 = document.getElementById("formelement");
            const formData = new FormData(form1);

            const id = formData.get("ID");
            const name = formData.get("Name");
            const price = parseFloat(formData.get("Price"));

            let xhr = new XMLHttpRequest();
            xhr.open("PUT", "https://56pkakyp2j.execute-api.us-east-2.amazonaws.com/items");
            xhr.setRequestHeader("Content-Type", "application/json");

            
            xhr.send(JSON.stringify({
                "id": id,
                "price": name,
                "name": price
            }));
        }




    </script>

</body>

</html>
